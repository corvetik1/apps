# 1. Использование Nx Workspace для монорепозитория

Дата: 2025-04-29

## Статус

Принято

## Контекст

Для разработки современной финансовой платформы необходимо организовать эффективную структуру проекта, которая позволит:
-Объединить frontend (React) и backend (NestJS) части в одном репозитории
-Обеспечить переиспользование кода между частями приложения
-Упростить CI/CD процессы
-Поддерживать высокое качество кода через тестирование и статический анализ
-Обеспечить масштабируемость проекта при росте кодовой базы

## Рассмотренные варианты

1. **Отдельные репозитории** для frontend и backend

   - Плюсы: четкое разделение ответственности, независимая разработка
   - Минусы: сложность синхронизации общих типов, дублирование кода, сложность CI/CD

2. **Монорепозиторий с Lerna**

   - Плюсы: объединение кода в одном репозитории, общие зависимости
   - Минусы: ограниченные возможности для оптимизации CI/CD, отсутствие встроенных генераторов кода

3. **Монорепозиторий с Nx Workspace**

   - Плюсы: инкрементальные сборки, кэширование, генераторы кода, интеграция с CI/CD, анализ зависимостей
   - Минусы: более сложная начальная настройка, необходимость обучения команды

4. **Монорепозиторий с Turborepo**
   - Плюсы: простая настройка, кэширование, параллельное выполнение задач
   - Минусы: меньше возможностей для генерации кода, меньше интеграций с инструментами

## Решение

Выбран **Nx Workspace** как инструмент для организации монорепозитория финансовой платформы.

## Обоснование

1. **Инкрементальные сборки и кэширование** - Nx отслеживает зависимости между проектами и пересобирает только то, что изменилось, что значительно ускоряет CI/CD процессы.

2. **Встроенная поддержка React и NestJS** - Nx предоставляет готовые пресеты и генераторы для React и NestJS, что упрощает настройку и разработку.

3. **Общие библиотеки** - Nx позволяет легко создавать и использовать общие библиотеки (типы, утилиты, компоненты) между frontend и backend.

4. **Интеграция с CI/CD** - Nx предоставляет команды `affected`, которые позволяют запускать тесты и сборки только для измененных проектов, что ускоряет CI/CD.

5. **Анализ зависимостей** - Nx предоставляет инструменты для визуализации и анализа зависимостей между проектами, что помогает поддерживать чистую архитектуру.

6. **Масштабируемость** - Nx хорошо масштабируется при росте кодовой базы, что важно для долгосрочного развития проекта.

## Последствия

1. **Структура проекта** - Проект будет организован в соответствии с рекомендациями Nx:

   - `apps/web` - Frontend приложение на React
   - `apps/api` - Backend приложение на NestJS
   - `libs/` - Общие библиотеки

2. **Процесс разработки** - Разработчики должны ознакомиться с концепциями Nx и использовать генераторы для создания новых компонентов, модулей и библиотек.

3. **CI/CD** - CI/CD процессы будут настроены с использованием `nx affected` для оптимизации времени сборки и тестирования.

4. **Обучение команды** - Необходимо провести обучение команды по работе с Nx Workspace и его инструментами.

5. **Документация** - В README проекта будет добавлен раздел с инструкциями по работе с Nx.
